<ion-header-component
  [headerTitle]="HEADER_TITLE"
  [showBackButton]="true"
  [defaultTarget]="'/admin'"
>
</ion-header-component>

<ion-content>
  <ion-grid>
    <ion-row>
      <ion-col>
        <h1 class="title-xl">{{TITLE}}</h1>
      </ion-col>
    </ion-row>
    

    <!-- CALENDAR HEADER -->
    <ion-row class="ion-align-items-center">
      <!-- TOGGLE PREV/NOW/NEXT -->
      <ion-col size="12" size-md="3" offset-md="3">
        <ion-button
          size="small"
          color="primary"
          mwlCalendarPreviousView
          [view]="view"
          [(viewDate)]="viewDate"
          (viewDateChange)="onViewDateChange($event)"
        >
          <ion-icon name="arrow-back-outline"></ion-icon>
        </ion-button>
        <ion-button
          size="small"
          color="primary"
          mwlCalendarToday
          [(viewDate)]="viewDate"
        >
          En cours
        </ion-button>
        <ion-button
          size="small"
          color="primary"
          mwlCalendarNextView
          [view]="view"
          [(viewDate)]="viewDate"
          (viewDateChange)="onViewDateChange($event)"
        >
          <ion-icon name="arrow-forward-outline"></ion-icon>
        </ion-button>
      </ion-col>

      <!-- CURRENT DATE RANGE -->
      <ion-col size="12" size-md="3">
        <h3>
          {{ viewDate | calendarDate: view + 'ViewTitle':'fr' | uppercase }}
        </h3>
      </ion-col>
      <!-- TOGGLE VIEW DAY/WEEK/MONTH -->
      <!-- <ion-col size="12" size-md="3" offset-md="3">
        <div class="btn-group">
           <div
        class="btn btn-primary"
        (click)="setView(calendarViewEnum.Week)"
        [ngClass]="{ active: view === calendarViewEnum.Week }"
      >
        Semaine
      </div> 
           <div
        class="btn btn-primary"
        (click)="setView(calendarViewEnum.Month)"
        [ngClass]="{ active: view === calendarViewEnum.Month }"
      >
        Mois
      </div>

           <div
        class="btn btn-primary"
        (click)="setView(calendarViewEnum.Day)"
        [class.active]="view === calendarViewEnum.Day"
      >
        Day
      </div> 
        </div>
      </ion-col> -->
    </ion-row>

    <!-- CALENDAR GRID -->
    <ion-row>
      <ion-col size="12" size-md="8" offset-md="2">
        <!-- HOUR ROWS  -->
        <ng-template
          #weekViewHourSegment
          let-segment="segment"
          let-locale="locale"
          let-segmentHeight="segmentHeight"
          let-isTimeLabel="isTimeLabel"
        >
          <div
            class="cal-hour-segment"
            [style.height.px]="segmentHeight"
            [class.cal-hour-start]="segment.isStart"
            [class.cal-after-hour-start]="!segment.isStart"
            [ngClass]="segment.cssClass"
          >
            <div class="cal-time" *ngIf="isTimeLabel">
              {{ segment.date | date: 'H' }}h
            </div>
          </div>
        </ng-template>

        <!-- EXPORT GROUP -->
        <ng-template
          #customEventTemplate
          let-weekEvent="weekEvent"
          let-tooltipPlacement="tooltipPlacement"
          let-eventClicked="eventClicked"
          let-tooltipTemplate="tooltipTemplate"
          let-tooltipAppendToBody="tooltipAppendToBody"
          let-tooltipDisabled="tooltipDisabled"
          let-tooltipDelay="tooltipDelay"
          let-column="column"
        >
          <!-- GROUP EXPORTS POP OVER -->
          <ng-template #groupedEventsTemplate>
            <div style="min-width: 250px">
              <div
                class="d-flex justify-content-between py-1"
                *ngFor="let event of weekEvent.event.meta.groupedEvents"
              >
                <mwl-calendar-event-title
                  class="text-uppercase"
                  [event]="event"
                  view="week"
                ></mwl-calendar-event-title>
                &ngsp;
                <mwl-calendar-event-actions
                  [event]="event"
                ></mwl-calendar-event-actions>
              </div>
            </div>
          </ng-template>

          <!-- GROUP EXPORTS CEL -->
          <!-- [ngbPopover]="groupedEventsTemplate"
  [disablePopover]="!weekEvent.event.meta.groupedEvents" -->
          <div
            class="cal-event d-flex justify-content-between"
            [ngStyle]="{
      backgroundColor: weekEvent.event.color?.secondary,
      borderColor: weekEvent.event.color?.primary
    }"
            [mwlCalendarTooltip]="
      !tooltipDisabled && !weekEvent.event.meta.groupedEvents
        ? (weekEvent.event.title | calendarEventTitle: 'weekTooltip':weekEvent.event)
        : ''
    "
            [tooltipPlacement]="tooltipPlacement"
            [tooltipEvent]="weekEvent.event"
            [tooltipTemplate]="tooltipTemplate"
            [tooltipAppendToBody]="tooltipAppendToBody"
            [tooltipDelay]="tooltipDelay"
          >
            <!-- Export actions -->
            <ng-container *ngIf="!weekEvent.event.meta.groupedEvents">
              <mwl-calendar-event-actions
                [event]="weekEvent.event"
              ></mwl-calendar-event-actions>
              &ngsp;
            </ng-container>

            <!-- Export title -->
            <mwl-calendar-event-title
              [event]="weekEvent.event"
              view="week"
              class="event--title"
            ></mwl-calendar-event-title>
          </div>
        </ng-template>

        <!-- DISPLAYED VIEW AS A WEEK CALENDAR -->
        <div [ngSwitch]="view">
          <mwl-calendar-week-view
            *ngSwitchCase="calendarViewEnum.Week"
            [viewDate]="viewDate"
            [refresh]="refresh$"
            [events]="groupedSimilarExports"
            [hourSegmentTemplate]="weekViewHourSegment"
            [eventTemplate]="customEventTemplate"
            (hourSegmentClicked)="onSelectedTime($event.date)"
            (beforeViewRender)="beforeWeekViewRender($event)"
          ></mwl-calendar-week-view>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
